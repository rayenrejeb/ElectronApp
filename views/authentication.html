<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Bootstrap Login &amp; Register Templates</title>

        <!-- CSS -->
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500">
        <link rel="stylesheet" href="./../assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="./../assets/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="./../assets/css/form-elements.css">
        <link rel="stylesheet" href="./../assets/css/style.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Favicon and touch icons -->
        <link rel="shortcut icon" href="./../assets/ico/favicon.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="./../assets/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="./../assets/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./../assets/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="./../assets/ico/apple-touch-icon-57-precomposed.png">

    </head>

    <body>

        <!-- Top content -->
        <div class="top-content">
        	
            <div >
                <div class="container">
                	
                    <div class="row">
                        <div class="col-sm-8 col-sm-offset-2 text">
                            <h1><strong>Prodage</strong> Manage &amp; order stuff</h1>
                            <div class="description">
                            	<p>
	                            	Run your project from your computer
                            	</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-5">
                        	
                        	<div style="margin-top: 5vw">
	                        	<div class="form-top">
	                        		<div class="form-top-left">
	                        			<h3>Login</h3>
	                            		<p>Enter username and password to log on:</p>
	                        		</div>
	                        		<div class="form-top-right">
	                        			<i class="fa fa-lock"></i>
	                        		</div>
	                            </div>
	                            <div class="form-bottom">
				                    <form role="form" action="" method="post" class="login-form">
				                    	<div class="form-group">
                                                <div class="alert alert-danger" id="notification-user-not-found" style="display: none">Check username/password</div>
				                    		<label class="sr-only" for="form-username">Username</label>
				                        	<input type="text" name="form-username" id="form-username" placeholder="Username..." class="form-username form-control" id="form-username" required>
				                        </div>
				                        <div class="form-group">
				                        	<label class="sr-only" for="form-password">Password</label>
				                        	<input type="password" name="form-password" id="form-userpassword" placeholder="Password..." class="form-password form-control" id="form-password" required>
				                        </div>
				                        <input type="button" class="btn btn-info btn-lg btn-block" onclick="signin()" value="Sign in!">
				                    </form>
			                    </div>
		                    </div>

	                        
                        </div>
                        
                        <div class="col-sm-1 middle-border"></div>
                        <div class="col-sm-1"></div>
                        	
                        <div class="col-sm-5">
                        	
                        	<div class="">
                        		<div class="form-top">
	                        		<div class="form-top-left">
	                        			<h3>Sign up now</h3>
	                            		<p>Fill in the form below to get instant access:</p>
	                        		</div>
	                        		<div class="form-top-right">
	                        			<i class="fa fa-pencil"></i>
	                        		</div>
	                            </div>
	                            <div class="form-bottom">
				                    <form class="registration-form">
                                        <div class="alert alert-danger" id="notification-danger-empty-form" style="display: none">Please fill the form !</div>
                                        <div class="alert alert-danger" id="notification-danger" style="display: none">User already exists !</div>
                                        <div class="alert alert-danger" id="notification-danger-password-match" style="display: none">Passwords not matched !</div>
                                        <div class="alert alert-danger" id="notification-danger-password-verification" style="display: none">Password: minimum eight characters, at least one letter and one number</div>
                                        <div class="alert alert-danger" id="notification-danger-email-verification" style="display: none">Verify your email</div>
                                        <div class="alert alert-success" id="notification-succes" style="display: none">User have been added !</div>
                                        <div class="form-group">
				                    		<label class="sr-only" for="form-first-name">Username</label>
				                        	<input type="text" name="form-first-name" placeholder="Username..." class="form-first-name form-control" id="form-user-name" required>
				                        </div>
				                        <div class="form-group">
                                                <label class="sr-only" for="form-email">Email</label>
                                                <input type="text" name="form-email" placeholder="Email..." class="form-email form-control" id="form-email" required>
                                            </div>
				                        <div class="form-group">
				                        	<label class="sr-only" for="form-email">Password</label>
				                        	<input type="password" name="form-email" placeholder="Password..." class="form-password form-control" id="form-user-password" required>
				                        </div>
				                        <div class="form-group">
				                        	<label class="sr-only" for="form-about-yourself">Confirm password</label>
				                        	<input type="password" name="form-password" placeholder="Confirm password..." class="form-password form-control" id="form-user-confirm-password" required>
				                        </div>
				                        <input type="button" class="btn btn-info btn-lg btn-block" onclick="signup()" value="Sign me up!">
				                    </form>
			                    </div>
                        	</div>
                        	
                        </div>
                    </div>
                    
                </div>
            </div>
            
        </div>

        <!-- Footer -->
        <footer>
            <br>
        	<div class="container">
        		<div class="row">
        			
        			<div class="col-sm-8 col-sm-offset-2">
        				<div class="footer-border"></div>
        				<p>Made by <strong>O</strong>pra<strong>D</strong>ev</a> <i class="fa fa-smile-o"></i></p>
        			</div>
        			
        		</div>
        	</div>
        </footer>

        <!-- Javascript -->
        <script src="./../assets/js/jquery-1.11.1.min.js"></script>
        <script src="./../assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="./../assets/js/jquery.backstretch.min.js"></script>
        <script src="./../assets/js/scripts.js"></script>

        <script>
            const electron = require('electron')
            const { ipcRenderer } = electron

            function signup(){
                let uname = document.getElementById("form-user-name").value
                let email = document.getElementById("form-email").value
                let password = document.getElementById("form-user-password").value
                let cpassword = document.getElementById("form-user-confirm-password").value
                
                let notifSucces = document.getElementById("notification-succes")
                let notifUserExists = document.getElementById("notification-danger")
                let notifPassMatch = document.getElementById("notification-danger-password-match")
                let notifPassVerify = document.getElementById("notification-danger-password-verification")
                let notifEmailVerify = document.getElementById("notification-danger-email-verification")
                let notifEmptyForm = document.getElementById("notification-danger-empty-form")
                let emailForm = new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)
                let passwordForm = new RegExp(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/)

                if((uname == '') || (email == '') || (password == '') || (cpassword == '') ){
                    if (notifEmptyForm.style.display === "none"){
                        notifEmptyForm.style.display = "block"
                        notifPassMatch.style.display = "none"
                        notifPassVerify.style.display = "none"
                        notifEmailVerify.style.display = "none"
                        notifUserExists.style.display = "none"
                        notifSucces.style.display = "none"
                        console.log("empty form verif")
                    }
                }
                else if(!emailForm.test(email)){
                    if(notifEmailVerify.style.display === "none"){
                        notifEmptyForm.style.display = "none"
                        notifPassMatch.style.display = "none"
                        notifPassVerify.style.display = "none"
                        notifEmptyForm.style.display = "none"
                        notifEmailVerify.style.display = "block"
                        notifUserExists.style.display = "none"
                        notifSucces.style.display = "none"
                        console.log("email verif")
                    }
                }
                else if(!passwordForm.test(password)){
                        notifEmptyForm.style.display = "none"
                        notifPassMatch.style.display = "none"
                        notifPassVerify.style.display = "block"
                        notifEmptyForm.style.display = "none"
                        notifEmailVerify.style.display = "none"
                        notifUserExists.style.display = "none"
                        notifSucces.style.display = "none"
                        console.log(passwordForm.test(password))
                }
                else if(password != cpassword){
                        notifEmptyForm.style.display = "none"
                        notifPassMatch.style.display = "block"
                        notifPassVerify.style.display = "none"
                        notifEmptyForm.style.display = "none"
                        notifEmailVerify.style.display = "none"
                        notifUserExists.style.display = "none"
                        notifSucces.style.display = "none"
                }
                else{
                    let user = {"username" : uname, "email": email, "password": password}
                    console.log(user)
                    ipcRenderer.send('new:user', user)
                    ipcRenderer.on('user:exists', function(){

                        if (notifUserExists.style.display === "none") {
                            notifUserExists.style.display = "block"
                            notifEmptyForm.style.display = "none"
                            notifPassMatch.style.display = "block"
                            notifPassVerify.style.display = "none"
                            notifEmptyForm.style.display = "none"
                            notifEmailVerify.style.display = "none"
                            notifSucces.style.display = "none"
                        }
                    })

                    ipcRenderer.on('user:added', function(){
                        
                        if (notifSucces.style.display === "none") {
                            notifSucces.style.display = "block";
                            notifUserExists.style.display = "none"
                            notifEmptyForm.style.display = "none"
                            notifPassMatch.style.display = "none"
                            notifPassVerify.style.display = "none"
                            notifEmptyForm.style.display = "none"
                            notifEmailVerify.style.display = "none"
                        }
                    })
                }
            }
            
            function signin(){
                let usernameSignIn = document.getElementById("form-username").value
                let userPasswordSignIn = document.getElementById("form-userpassword").value
                let notifyUser404 = document.getElementById("notification-user-not-found")
                let userSignIn = {"username": usernameSignIn, "password": userPasswordSignIn}
                //check if user exists
                ipcRenderer.send("user:check", userSignIn)
                console.log(userSignIn)
                //check server response
                ipcRenderer.on("user:doesNotExist", function(e, data){
                    if(notifyUser404.style.display === "none")
                        notifyUser404.style.display = "block"
                })
            }
        </script>
        
        <!--[if lt IE 10]>
            <script src="./../assets/js/placeholder.js"></script>
        <![endif]-->

    </body>

</html>